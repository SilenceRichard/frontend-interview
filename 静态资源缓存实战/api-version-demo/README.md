# 前端版本探针机制演示

这个示例演示了前端代码与API数据版本不一致时的问题，以及如何通过版本探针（Version Probe）机制解决。

## 问题说明

**现象**：后端 API 返回了新的数据结构（Schema），但前端运行的还是旧版本的 JS 代码，导致数据处理出错或展示异常。

**原因**：前端代码缓存未更新，但 API 接口已经更新了。

## 解决方案

本示例实现了一个版本探针机制，通过以下步骤检测和处理版本不一致的问题：

1. 每次页面加载时，请求一个包含最新版本信息的文件（`version.json`）
2. 比较当前运行的前端代码版本与服务器返回的最新版本
3. 如果发现版本不匹配，提示用户刷新页面获取最新代码

## 如何运行

1. 使用HTTP服务器启动该目录（例如使用 `python -m http.server` 或 VS Code 的 Live Server 插件）
2. 打开浏览器访问页面
3. 点击"加载V1 API数据"按钮，查看正常工作的情况
4. 点击"加载V2 API数据"按钮，查看版本不匹配导致的问题

## 实现细节

本示例中的文件说明：

- `index.html` - 页面结构
- `styles.css` - 页面样式
- `app.js` - 实现版本探针机制的前端代码
- `version.json` - 服务端返回的最新版本信息
- `api/users-v1.json` - 旧版API数据（版本1.0.0）
- `api/users-v2.json` - 新版API数据（版本2.0.0，数据结构有变化）

## 在实际项目中的应用

在生产环境中，`version.json` 可以通过构建过程自动生成，包含代码库的 commit hash 或版本号。同样，前端代码中的版本常量也可以在构建时自动注入。

常见的版本更新处理策略包括：

1. 强制刷新 - 发现版本不匹配时提示用户刷新页面
2. 后台更新 - 使用 Service Worker 在后台自动更新资源
3. 平滑迁移 - 实现向后兼容的 API，允许旧版前端代码正常工作 